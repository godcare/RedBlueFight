{"version":3,"sources":["Game5Control.js"],"names":["cc","Class","extends","Component","properties","GameResultNode","default","type","Node","CountDownNode","PauseNode","AllBalls","AllPans","PlacedBalls","PlacedPans","RedCount","BlueCount","PinchDistance","TouchableBalls","start","startAnimation","scheduleOnce","active","i","length","name","GameStatus","onEndMove","movedBall","log","ball","find","j","tmpJ","indexOf","toString","dist","Math","floor","sqrt","pow","x","y","substr","push","replace","bm","moveTo","position","runAction","ShowResult","winner","sa","scaleTo","sr","rotateBy","Global","GameData","CurrentWinner"],"mappings":"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","file":"Game5Control.js","sourceRoot":"..\\..\\..\\..\\..\\..\\..\\assets\\Scripts\\Control\\Games\\Game5","sourcesContent":["// Learn cc.Class:\r\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/class.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/class.html\r\n// Learn Attribute:\r\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/life-cycle-callbacks.html\r\n// var GameDragMove = require(\"Game5DragMove\");\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        // foo: {\r\n        //     // ATTRIBUTES:\r\n        //     default: null,        // The default value will be used only when the component attaching\r\n        //                           // to a node for the first time\r\n        //     type: cc.SpriteFrame, // optional, default is typeof default\r\n        //     serializable: true,   // optional, default is true\r\n        // },\r\n        // bar: {\r\n        //     get () {\r\n        //         return this._bar;\r\n        //     },\r\n        //     set (value) {\r\n        //         this._bar = value;\r\n        //     }\r\n        // },\r\n        GameResultNode:\r\n        {\r\n            default: null,\r\n            type: cc.Node,\r\n        },\r\n        CountDownNode:\r\n        {\r\n            default: null,\r\n            type: cc.Node,\r\n        },\r\n        PauseNode:\r\n        {\r\n            default: null,\r\n            type: cc.Node,\r\n        },\r\n        AllBalls:\r\n        {\r\n            default: [],\r\n            type: [cc.Node],\r\n        },\r\n        AllPans:\r\n        {\r\n            default: [],\r\n            type: [cc.Node],\r\n        },\r\n        PlacedBalls:\r\n        {\r\n            default: [],\r\n        },\r\n\r\n        PlacedPans:\r\n        {\r\n            default: [],\r\n        },\r\n        RedCount: 0,\r\n        BlueCount: 0,\r\n        PinchDistance: 60,//吸入的距离\r\n        TouchableBalls: \"\",\r\n    },\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    // onLoad () {},\r\n\r\n    start() {\r\n        this.startAnimation();\r\n    },\r\n\r\n    startAnimation() {\r\n        this.scheduleOnce(function () {\r\n            this.CountDownNode.active = true;\r\n        }, 0.5)\r\n        this.scheduleOnce(function () {\r\n            for (var i = 0; i < this.AllBalls.length; i++) {\r\n                this.TouchableBalls += this.AllBalls[i].name;\r\n            }\r\n            this.GameStatus = 1;\r\n            this.PauseNode.active = true;\r\n\r\n        }, 4.5);\r\n\r\n    },\r\n\r\n    onEndMove(movedBall) {\r\n        cc.log(\"cancel move ball:\" + movedBall);\r\n        var ball = cc.find(\"Canvas/GameCore/\" + movedBall);\r\n        for (var j = 0; j < this.AllPans.length; j++) {\r\n            //判断所有未装球的盘\r\n            // cc.log(\"Pan:\" + this.PlacedPans);\r\n            var tmpJ = this.PlacedPans.indexOf(j.toString());\r\n            if (tmpJ == -1) {\r\n                var dist = Math.floor(Math.sqrt(Math.pow(ball.x - this.AllPans[j].x, 2) + Math.pow(ball.y - this.AllPans[j].y, 2)));//判断距离\r\n                // cc.log(\"i:\" + i + \" j:\" + j + \" dist:\" + dist + \" pDist\" + this.PinchDistance);\r\n                if (dist <= this.PinchDistance) {\r\n                    var i = movedBall.substr(movedBall.length - 1, 1);\r\n                    this.PlacedBalls.push(i);\r\n                    this.PlacedPans.push(j.toString());\r\n                    cc.log(\"i:\" + i + \" j:\" + j + \" Dist:\" + dist);\r\n                    // this.AllBalls[i].getComponent(GameDragMove).enabled = false;\r\n                    this.TouchableBalls = this.TouchableBalls.replace(movedBall, \"\");\r\n                    var bm = cc.moveTo(0.2, this.AllPans[j].position);\r\n                    ball.runAction(bm);\r\n                    if (i <= 3) {\r\n                        this.BlueCount += 1;\r\n                    }\r\n                    else {\r\n                        this.RedCount += 1;\r\n                    }\r\n                    if (this.RedCount >= 4) {\r\n                        this.ShowResult(0);\r\n                    }\r\n                    else if (this.BlueCount >= 4) {\r\n                        this.ShowResult(1);\r\n                    }\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n    },\r\n\r\n    ShowResult(winner) {\r\n        this.TouchableBalls = \"\";\r\n        this.GameStatus = 2;\r\n        this.scheduleOnce(function () {\r\n            if (winner == 0) {\r\n\r\n                for (var i = 0; i < this.PlacedBalls.length; i++) {\r\n                    if (this.PlacedBalls[i] >= 4) {\r\n                        var sa = cc.scaleTo(0.7, 1, 1);\r\n                        var sr = cc.rotateBy(0.7, 360);\r\n                        cc.find(\"Canvas/GameCore/\" + this.PlacedBalls[i]).runAction(sa);\r\n                        cc.find(\"Canvas/GameCore/\" + this.PlacedBalls[i]).runAction(sr);\r\n                    }\r\n\r\n                }\r\n                this.scheduleOnce(function () {\r\n                    Global.GameData.CurrentWinner = 0;\r\n                    this.GameResultNode.active = true;\r\n                }, 2);\r\n            }\r\n\r\n            else if (winner == 1) {\r\n                for (var i = 0; i < this.PlacedBalls.length; i++) {\r\n                    if (this.PlacedBalls[i] <= 3) {\r\n                        var sa = cc.scaleTo(0.7, 1, 1);\r\n                        var sr = cc.rotateBy(0.7, 360);\r\n                        cc.find(\"Canvas/GameCore/\" + this.PlacedBalls[i]).runAction(sa);\r\n                        cc.find(\"Canvas/GameCore/\" + this.PlacedBalls[i]).runAction(sr);\r\n                    }\r\n\r\n                }\r\n                this.scheduleOnce(function () {\r\n                    Global.GameData.CurrentWinner = 1;\r\n                    this.GameResultNode.active = true;\r\n                }, 2);\r\n\r\n            }\r\n        }, 0.5)\r\n    },\r\n    // update (dt) {},\r\n});\r\n"]}